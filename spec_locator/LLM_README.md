# å¤§æ¨¡å‹è¯†åˆ«åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install volcenginesdkarkruntime tenacity
```

### 2. é…ç½®APIå¯†é’¥

**è·å–è±†åŒ…APIå¯†é’¥**:
1. è®¿é—® https://console.volcengine.com/ark
2. ç™»å½•å¹¶åˆ›å»ºAPIå¯†é’¥
3. å¤åˆ¶APIå¯†é’¥

**é…ç½®æ–¹æ³•**:
```bash
# æ–¹å¼1ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
export DOUBAO_API_KEY=your_api_key_here

# æ–¹å¼2ï¼š.envæ–‡ä»¶
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å…¥APIå¯†é’¥
```

### 3. å¯åŠ¨æœåŠ¡

```bash
cd d:\projects\liuzong
uvicorn spec_locator.api.server:app --host 0.0.0.0 --port 8002
```

### 4. è®¿é—®æ¼”ç¤ºé¡µé¢

- **Swaggeræ–‡æ¡£**: http://localhost:8002/docs
- **æ¼”ç¤ºé¡µé¢**: file:///D:/projects/liuzong/spec_locator/api/demo.html

## ä½¿ç”¨æ–¹å¼

### æ–¹å¼1ï¼šé€šè¿‡å‰ç«¯ç•Œé¢

1. æ‰“å¼€ `demo.html`
2. é€‰æ‹©è¯†åˆ«æ–¹å¼ï¼š
   - **OCRè¯†åˆ«**: å¿«é€Ÿï¼Œé€‚åˆæ¸…æ™°å›¾åƒ
   - **å¤§æ¨¡å‹è¯†åˆ«**: æ™ºèƒ½ï¼Œé€‚åˆå¤æ‚åœºæ™¯
   - **æ™ºèƒ½åˆ‡æ¢**: è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ–¹å¼
3. ä¸Šä¼ CADæˆªå›¾
4. æŸ¥çœ‹è¯†åˆ«ç»“æœ

### æ–¹å¼2ï¼šé€šè¿‡APIè°ƒç”¨

```python
import requests

url = "http://localhost:8002/api/spec-locate"
files = {"file": open("screenshot.png", "rb")}
params = {"method": "llm"}  # æˆ– "ocr" / "auto"

response = requests.post(url, files=files, params=params)
result = response.json()
print(result)
```

### æ–¹å¼3ï¼šé€šè¿‡cURL

```bash
# OCRè¯†åˆ«ï¼ˆé»˜è®¤ï¼‰
curl -X POST "http://localhost:8002/api/spec-locate" \
  -F "file=@screenshot.png"

# å¤§æ¨¡å‹è¯†åˆ«
curl -X POST "http://localhost:8002/api/spec-locate?method=llm" \
  -F "file=@screenshot.png"

# æ™ºèƒ½åˆ‡æ¢
curl -X POST "http://localhost:8002/api/spec-locate?method=auto" \
  -F "file=@screenshot.png"
```

## è¯†åˆ«æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | é€Ÿåº¦ | å‡†ç¡®ç‡ | é€‚ç”¨åœºæ™¯ | æˆæœ¬ |
|-----|------|-------|---------|-----|
| OCR | âš¡ å¿« (< 1ç§’) | ä¸­ç­‰ | æ¸…æ™°æ ‡å‡†å›¾åƒ | å…è´¹ |
| å¤§æ¨¡å‹ | ğŸ¢ æ…¢ (3-5ç§’) | é«˜ | å¤æ‚æ¨¡ç³Šå›¾åƒ | ä»˜è´¹ |
| æ™ºèƒ½åˆ‡æ¢ | âš–ï¸ é€‚ä¸­ | é«˜ | é€šç”¨åœºæ™¯ | æŒ‰éœ€ |

**æ¨èä½¿ç”¨åœºæ™¯**:
- **æ¸…æ™°å›¾ç‰‡** â†’ OCRè¯†åˆ«
- **æ¨¡ç³Š/å€¾æ–œ/æ‰‹å†™** â†’ å¤§æ¨¡å‹è¯†åˆ«
- **ä¸ç¡®å®šè´¨é‡** â†’ æ™ºèƒ½åˆ‡æ¢

## é…ç½®è¯´æ˜

è¯¦è§ `.env.example` æ–‡ä»¶ï¼Œä¸»è¦é…ç½®é¡¹ï¼š

```bash
# å¯ç”¨å¤§æ¨¡å‹åŠŸèƒ½
LLM_ENABLED=true

# APIå¯†é’¥ï¼ˆå¿…å¡«ï¼‰
DOUBAO_API_KEY=your_api_key_here

# æ¨¡å‹é€‰æ‹©
LLM_MODEL=doubao-vision-pro

# è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
LLM_TIMEOUT=30

# æ™ºèƒ½åˆ‡æ¢é˜ˆå€¼
OCR_CONFIDENCE_THRESHOLD=0.6
```

## å¸¸è§é—®é¢˜

### Q: å¤§æ¨¡å‹è¯†åˆ«å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A**: 
- ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°OCRè¯†åˆ«ï¼ˆautoæ¨¡å¼ä¸‹ï¼‰
- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/app.log`

### Q: å¦‚ä½•æé«˜è¯†åˆ«å‡†ç¡®ç‡ï¼Ÿ
**A**: 
1. ä½¿ç”¨å¤§æ¨¡å‹è¯†åˆ«
2. ç¡®ä¿å›¾ç‰‡æ¸…æ™°åº¦
3. ä½¿ç”¨æ™ºèƒ½åˆ‡æ¢æ¨¡å¼

### Q: APIæˆæœ¬å¦‚ä½•æ§åˆ¶ï¼Ÿ
**A**: 
- é»˜è®¤ä½¿ç”¨OCRï¼ˆå…è´¹ï¼‰
- ä»…åœ¨éœ€è¦æ—¶é€‰æ‹©å¤§æ¨¡å‹
- æ™ºèƒ½åˆ‡æ¢æ¨¡å¼ä¼šä¼˜å…ˆä½¿ç”¨OCR

### Q: å“åº”æ—¶é—´å¤ªé•¿æ€ä¹ˆåŠï¼Ÿ
**A**: 
- OCRæ¨¡å¼å“åº”æœ€å¿«ï¼ˆ< 1ç§’ï¼‰
- å¤§æ¨¡å‹éœ€è¦3-5ç§’ï¼Œå¯è°ƒæ•´ `LLM_TIMEOUT`
- æ£€æŸ¥ç½‘ç»œè¿æ¥

### Q: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Ÿ
**A**: 
```bash
# Windows PowerShell
Get-Content logs/app.log -Tail 50 -Wait

# Linux/Mac
tail -f logs/app.log
```

## æˆæœ¬ä¼°ç®—

å‡è®¾è±†åŒ…è§†è§‰APIå®šä»·ï¼šÂ¥0.005/æ¬¡

| åœºæ™¯ | æ—¥è°ƒç”¨é‡ | æœˆè°ƒç”¨é‡ | æœˆè´¹ç”¨ï¼ˆå…ƒï¼‰ |
|-----|---------|---------|------------|
| å°è§„æ¨¡ | 10 | 300 | 1.5 |
| ä¸­ç­‰è§„æ¨¡ | 100 | 3000 | 15 |
| å¤§è§„æ¨¡ | 500 | 15000 | 75 |

**è¯´æ˜**: ä»…ç»Ÿè®¡LLMè°ƒç”¨ï¼ŒOCRå…è´¹

## æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´
- **OCR**: 0.8-1.5ç§’
- **LLM**: 3-5ç§’
- **Auto**: 1-6ç§’ï¼ˆå–å†³äºæ˜¯å¦è§¦å‘LLMï¼‰

### å‡†ç¡®ç‡ï¼ˆå‚è€ƒï¼‰
- **æ¸…æ™°å›¾ç‰‡**: OCR 95% / LLM 92%
- **æ¨¡ç³Šå›¾ç‰‡**: OCR 60% / LLM 85%
- **å¤æ‚èƒŒæ™¯**: OCR 50% / LLM 75%

## æ•…éšœæ’æŸ¥

### é”™è¯¯1: LLM_NOT_CONFIGURED
**åŸå› **: APIå¯†é’¥æœªé…ç½®  
**è§£å†³**: è®¾ç½® `DOUBAO_API_KEY` ç¯å¢ƒå˜é‡

### é”™è¯¯2: LLM_TIMEOUT
**åŸå› **: è¯·æ±‚è¶…æ—¶  
**è§£å†³**: 
- å¢åŠ  `LLM_TIMEOUT` é…ç½®
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- åˆ‡æ¢åˆ°OCRæ¨¡å¼

### é”™è¯¯3: è¯†åˆ«ç»“æœä¸å‡†ç¡®
**åŸå› **: Promptæˆ–å›¾ç‰‡è´¨é‡é—®é¢˜  
**è§£å†³**:
- å°è¯•ä¸åŒçš„è¯†åˆ«æ–¹å¼
- ç¡®ä¿å›¾ç‰‡åŒ…å«è§„èŒƒç¼–å·å’Œé¡µç 
- æŸ¥çœ‹ `metadata.llm_reasoning` äº†è§£æ¨¡å‹æ¨ç†

## æŠ€æœ¯æ”¯æŒ

- **è®¾è®¡æ–‡æ¡£**: [LLM_INTEGRATION_DESIGN.md](LLM_INTEGRATION_DESIGN.md)
- **å¼€å‘æŒ‡å—**: [LLM_INTEGRATION_GUIDE.md](LLM_INTEGRATION_GUIDE.md)
- **APIæ–‡æ¡£**: [LLM_API_DOCS.md](LLM_API_DOCS.md)

---

**æœ€åæ›´æ–°**: 2026-01-29
