# 建築規範スマート認識・検索システム - 面接紹介ドキュメント

## 📋 プロジェクト概要

これはAI技術に基づく建築規範のスマート認識・検索システムで、建築設計・施工分野における**CAD図面に引用されている規範詳細図の迅速な特定**という課題を解決します。システムは**規範位置特定サービス**と**RAGスマート質問応答**という2つのコア機能モジュールを含みます。

**コアバリュー**：従来5～10分かかっていた手動での規範検索プロセスを、1秒以内に自動完了し、建築設計者の作業効率を大幅に向上させます。

---

## 🎯 ビジネス背景

### 業界の課題
建築設計プロセスにおいて、CAD図面は標準図集（例：「23J909 1-11」）を大量に参照しており、設計者は以下の作業が必要です：
1. スクリーンショット内の規範番号とページ番号を認識
2. 膨大なPDFファイルから該当文書を検索
3. 具体的なページ番号を特定し詳細図を確認

このプロセスは煩雑でミスが発生しやすく、作業効率に影響します。

### ソリューション
- **自動認識**：CADスクリーンショットをアップロードし、規範番号とページ番号を自動認識
- **迅速な特定**：2680+件の規範ファイルから正確にマッチング
- **即時取得**：該当するPDFファイルを直接ダウンロード

---

## 🏗️ システムアーキテクチャ

### 全体アーキテクチャ
```
┌─────────────────────────────────────────────────────────┐
│                    フロントエンド                         │
│                  (Web UI + API Docs)                    │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                  FastAPI バックエンド                     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  画像アップ  │  │  認識エンジン│  │  ファイル特定│  │
│  │  ロード前処理│  │  OCR/LLM     │  │  DLサービス  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│            データ層 (2680+ PDFファイル)                  │
│        + ChromaDBベクトルDB (RAG拡張機能)                │
└─────────────────────────────────────────────────────────┘
```

### コアモジュール
```
spec_locator/
├── api/              # FastAPIサービス層
│   ├── server.py     # HTTPインターフェース
│   └── demo.html     # Webインターフェース
├── core/             # コア認識フロー
│   └── pipeline.py   # 認識メインフロー
├── ocr/              # OCR認識エンジン
│   └── ocr_engine.py # PaddleOCRラッパー
├── llm/              # LLM認識エンジン
│   ├── doubao_engine.py   # Doubao
│   ├── chatgpt_engine.py  # GPT
│   └── gemini_engine.py   # Gemini
├── preprocess/       # 画像前処理
├── parser/           # 解析とマッチング
├── postprocess/      # 信頼度評価
└── database/         # ファイルインデックス
```

---

## 💡 コア技術ハイライト

### 1. デュアルエンジン認識システム

#### **OCR認識エンジン** (主要方式)
- **技術選定**：PaddleOCR - 中国産オープンソースOCRエンジン
- **パフォーマンス優位性**：認識速度<1秒、高速起動、完全無料
- **コアフロー**：
  ```python
  画像 → 前処理(線除去/強調/二値化) → OCR認識 
       → 規範番号解析 → ページ番号認識 → 幾何学的関係分析 
       → 信頼度評価 → ソート出力
  ```
- **技術的課題**：
  - **規範番号認識**：多様な形式をサポート（12J2、L13J5-1、津07SJ110等）
  - **ページ番号認識**：C11、1-11、123等の複雑な形式を処理
  - **幾何学的関係分析**：空間位置を通じて規範番号とページ番号をマッチング

#### **LLM認識エンジン** (補完方式)
- **技術選定**：複数の大規模モデルをサポート（Doubao Vision/GPT-4o/Gemini）
- **優位性**：画像の意味を直接理解、複雑なルール不要、高いエラー耐性
- **適用シーン**：ぼやけ、傾き、手書き、またはOCR失敗の状況

### 2. スマート切替メカニズム (Autoモード)

これは私が設計したコアイノベーションで、**コストと効果の最適バランス**を実現：

| モード | 説明 | 速度 | 精度 | コスト |
|------|------|------|--------|------|
| **ocr** | 純粋なOCR認識 | ⚡ 速い (<1秒) | 中程度 | 無料 |
| **llm** | 純粋なLLM認識 | 🐢 遅い (3-5秒) | 高い | 有料 |
| **auto** | スマート切替 | ⚖️ 適中 | 高い | 必要に応じて |

**Autoモード戦略**：
```python
1. OCR認識を優先使用 (高速+無料)
2. リアルタイムで信頼度を評価 (0-1スコア)
3. 閾値以下の場合、自動的にLLMに切替 (正確+エラー耐性)
4. 最適な結果を返す
```

**実際の効果**：
- 80%のリクエストはOCRで処理（無料+高速）
- 20%の困難なケースはLLMで処理（精密）
- 全体の精度は90%+に向上

### 3. ファイルインデックスとマッチング

- **インデックス規模**：2680+ PDFファイル、30GB+データ
- **スマートマッチング**：
  - ファジーマッチング：12J2 ↔ 12J2-1 自動関連付け
  - 複数ページ番号形式：C11、1-11、123統一認識
  - 候補ソート：複数結果を信頼度でソート
- **パフォーマンス最適化**：
  - ファイルインデックスの事前読込（実行時スキャンを回避）
  - ホットデータのメモリキャッシュ
  - 同時アクセスサポート

### 4. 遅延ロードとパフォーマンス最適化

**問題**：PaddleOCRモデルのロードに3～5秒かかり、初回リクエストの体験に影響

**解決策**：
```python
class OCREngine:
    def __init__(self, lazy_load=True):
        self.model = None  # 遅延初期化
    
    def recognize(self, image):
        if self.model is None:
            self._load_model()  # 初回呼出時にロード
        return self._process(image)
```

**最適化効果**：
- サービス起動時間：8秒 → <1秒
- 初回リクエスト：4秒（モデルロード含む）
- 以降のリクエスト：<1秒

---

## 🚀 拡張機能：RAGスマート質問応答システム

### 技術アーキテクチャ
**検索拡張生成(RAG)**技術に基づき、建築知識質問応答システムを構築：

```
ユーザー質問 → ベクトル検索 → Rerank再ランク付け → LLM回答生成
                  ↓
            ChromaDBベクトルDB
         (規範DB + 事例DB)
```

### コアモジュール

#### 1. マルチエグゼキューターアーキテクチャ
- **anliku_executor.py**：建築事例DB検索
- **guifan_executor.py**：建築規範DB検索  
- **main_executor.py**：統一スケジューリングとルーティング

#### 2. Rerankerモジュール
3種類のReranker戦略を実装：
- **SimilarityReranker**：コサイン類似度ベース（高速）
- **LLMReranker**：大規模モデル評価ベース（精密）
- **HybridReranker**：ハイブリッド戦略（バランス型）

#### 3. インクリメンタルインデックス
```python
# ハッシュベースのインクリメンタル更新メカニズム
processed_hashes = load_processed_hashes()
for doc in new_docs:
    doc_hash = hash(doc.content)
    if doc_hash not in processed_hashes:
        index.add(doc)
        processed_hashes.add(doc_hash)
```

### 重要技術
- **ベクトルDB**：ChromaDB（軽量・デプロイ容易）
- **ドキュメント処理**：スマートチャンキング、重複排除、メタデータ抽出
- **マルチターン対話**：コンテキスト管理、対話履歴
- **ソーストレーサビリティ**：回答と元文書の関連付け

---

## 🛠️ 技術スタック

### バックエンド技術
- **Webフレームワーク**：FastAPI（非同期高性能）
- **OCRエンジン**：PaddleOCR（中国産オープンソース）
- **画像処理**：OpenCV、NumPy、PIL
- **LLM統合**：Doubao/ChatGPT/Gemini API
- **ベクトルDB**：ChromaDB
- **ドキュメント処理**：PyPDF、LangChain

### デプロイ技術
- **コンテナ化**：Docker + Docker Compose
- **クラウドプラットフォーム**：AWS EC2（本番環境にデプロイ済み）
- **Webサーバー**：Uvicorn（ASGIサーバー）

---

## 📊 プロジェクトデータ

| 指標 | データ |
|------|------|
| **コード規模** | 2500+行のコアコード |
| **モジュール数** | 8つのコアモジュール |
| **テストカバレッジ** | ユニットテスト + 統合テスト |
| **ドキュメント数** | 15+件の技術ドキュメント |
| **PDFインデックス** | 2680+件の規範ファイル |
| **データ規模** | 30GB+ PDFデータ |
| **認識速度** | OCR: <1秒, LLM: 3-5秒 |
| **認識精度** | 90%+ (Autoモード) |
| **APIエンドポイント** | 5つのコアインターフェース |
| **同時実行サポート** | 10+同時ユーザー |

---

## 🎓 個人貢献と成果

### コア貢献
1. **システム設計**：ゼロからシステムアーキテクチャ全体を設計
2. **デュアルエンジン実装**：OCRとLLM認識エンジンを独立実装
3. **スマート切替**：Autoモードのスマート切替戦略を設計・実装
4. **パフォーマンス最適化**：遅延ロード、並行処理等でパフォーマンスを最適化
5. **クラウドデプロイ**：AWS EC2本番環境デプロイを完了

### 技術成長
- **OCR技術**：OCRの原理、前処理、後処理を深く理解
- **LLMアプリケーション**：複数の大規模モデルAPI統合と最適化をマスター
- **RAGアーキテクチャ**：ベクトル検索、Rerank、プロンプトエンジニアリングを実践
- **FastAPI**：非同期フレームワークで高性能APIを構築する技術を習得
- **Dockerデプロイ**：コンテナ化デプロイとクラウド運用をマスター

### 問題解決能力
- **認識精度**：60%から90%+に最適化
- **起動速度**：8秒から<1秒に最適化
- **コスト制御**：スマート切替により80%のAPIコストを削減

---

## 🔮 プロジェクトハイライトまとめ

### 技術ハイライト
1. ✅ **デュアルエンジンアーキテクチャ**：OCR+LLMの相互補完、速度と精度を両立
2. ✅ **スマート切替**：Autoモードで最適戦略を自動選択
3. ✅ **遅延ロード最適化**：モデルロード遅延問題を解決
4. ✅ **標準化解析**：複数の複雑な形式の規範番号とページ番号を処理
5. ✅ **RAG拡張**：ドメイン知識質問応答システムを構築
6. ✅ **本番デプロイ**：完全なDockerコンテナ化とクラウドデプロイ

### ビジネス価値
1. 🎯 **効率向上**：規範検索時間を5～10分から1秒に短縮
2. 💰 **コスト最適化**：スマート切替で80%のAPIコストを削減
3. 📈 **高精度**：認識精度90%+達成
4. 🚀 **拡張性**：モジュール設計で新機能追加が容易

---

## 💼 プロジェクト紹介の提案

### デモポイント
1. **ビジネスシーン**：実際のCADスクリーンショット認識プロセスを展示
2. **技術比較**：OCR vs LLM vs Autoの違いをデモ
3. **APIドキュメント**：FastAPIが自動生成するSwaggerドキュメントを展示
4. **パフォーマンス指標**：認識速度と精度を展示

### 想定質問への準備
1. **Q: なぜPaddleOCRを選択したのですか？**
   - A: 中国産オープンソース、軽量、中英対応、GPUなしで高性能動作
   
2. **Q: Autoモードの切替閾値はどのように決定しましたか？**
   - A: 100+サンプルテストを通じて、信頼度0.7が最適閾値と判明
   
3. **Q: OCR認識エラーはどのように処理しますか？**
   - A: 3層処理：1)画像前処理強化 2)信頼度評価 3)LLMフォールバック
   
4. **Q: システムはどのように更に多くの規範をサポート拡張できますか？**
   - A: 指定ディレクトリにPDFファイルを追加するだけで、システムが自動スキャン・インデックス化
   
5. **Q: なぜ直接LLMを使用しないのですか？**
   - A: コスト考慮、OCRは無料かつ高速、LLMは精密な補完として機能

---

## 📞 プロジェクトリンク

- **プロジェクト場所**：ローカル開発環境
- **オンラインデモ**：AWS EC2デプロイ `http://<EC2-IP>:8002/`
- **APIドキュメント**：`http://<EC2-IP>:8002/docs`
- **技術ドキュメント**：プロジェクトルートディレクトリのmarkdownドキュメント

---

## 🎤 1分間エレベーターピッチ

> **建築規範スマート認識システム**を開発しました。建築設計者がCAD図面で規範詳細図を検索する際の課題を解決します。
> 
> システムは**OCR+LLMデュアルエンジンアーキテクチャ**を採用し、スマート切替戦略により**90%+の認識精度**を実現、同時に検索時間を**5～10分から1秒**に短縮しました。**Autoモード**を設計し、精度を保証しながら**80%のAPIコスト**を削減しました。
> 
> 技術スタックにはFastAPI、PaddleOCR、複数の大規模モデルAPI、およびChromaDBベースのRAG質問応答システムが含まれます。プロジェクトはDockerを通じてAWS本番環境にデプロイ済みで、**2680+件の規範ファイル**のリアルタイム検索をサポートします。
> 
> このプロジェクトを通じて、**OCR、LLM、RAG技術の実際の応用**、および**パフォーマンス、コスト、精度間のトレードオフ最適化**について深く理解しました。

---

*最終更新：2026年2月*
